"use strict";var Colors={Device:4409196,dark:2632749,white:16777215};function _objectSpread(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},a=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(i).filter(function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable}))),a.forEach(function(e){_defineProperty(t,e,i[e])})}return t}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var setValues=function(i){var a=this;void 0!==i&&Object.keys(i).map(function(e){var t=i[e];void 0!==t&&(a[e]=t)})},ShowBoard=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};THREE.Group.call(this),e=Object.assign({length:30,height:12,width:1,boardColor:5197647,marginX:1,marginY:.5,imageThickness:.05,boardImg:"img/showBoard/show_board_default.jpg"},e),this.setValues(e),this.init()};ShowBoard.prototype=Object.assign(Object.create(THREE.Group.prototype),{constructor:ShowBoard,init:function(){var i=this,e=new THREE.Mesh(new THREE.BoxGeometry(this.length,this.height,this.width),new THREE.MeshPhongMaterial({color:this.boardColor}));e.castShadow=!0,e.receiveShadow=!0,this.add(e),"none"===this.boardImg||(new THREE.TextureLoader).load(this.boardImg,function(e){var t=new THREE.Mesh(new THREE.PlaneGeometry(i.length-2*i.marginX,i.height-2*i.marginY),new THREE.MeshBasicMaterial({map:e}));t.position.z+=i.width/2+i.imageThickness,i.add(t)})},setValues:setValues});var Desk=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};THREE.Group.call(this),e=Object.assign({length:20,width:8,height:6,desktopColor:15658734,desktopThickness:1,legThickness:1,legColor:2632749},e),this.setValues(e),this.init()};Desk.prototype=Object.assign(Object.create(THREE.Group.prototype),{constructor:Desk,init:function(){var e=new THREE.Mesh(new THREE.BoxGeometry(this.length,this.desktopThickness,this.width),new THREE.MeshPhongMaterial({color:this.desktopColor}));e.castShadow=!0,e.receiveShadow=!0,e.position.y+=(this.height-this.desktopThickness)/2,this.add(e);var t=new THREE.Group,i=new THREE.BoxGeometry(this.legThickness,this.legThickness,this.width-2*this.legThickness),a=new THREE.BoxGeometry(this.legThickness,this.height-this.desktopThickness,this.legThickness),n=new THREE.MeshPhongMaterial({color:this.legColor}),o=new THREE.Mesh(i,n);o.castShadow=!0,o.receiveShadow=!0,o.position.y+=(this.height-this.desktopThickness-this.legThickness)/2,t.add(o);var r=new THREE.Mesh(a,n);r.castShadow=!0,r.receiveShadow=!0,r.position.z+=(this.width-this.legThickness)/2,t.add(r);var h=o.clone();h.position.y-=this.height-this.desktopThickness-this.legThickness,t.add(h);var s=r.clone();s.position.z-=this.width-this.legThickness,t.add(s),t.position.x-=(this.length-this.legThickness)/2,t.position.y-=this.desktopThickness/2,this.add(t);var l=t.clone();l.position.x+=this.length-this.legThickness,this.add(l)},setValues:setValues});var WorkBench=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};THREE.Group.call(this),e=Object.assign({length:28,width:8,height:10,desktopColor:2632749,desktopThickness:1,cabinetMarginSide:1,cabinetThickness:1,cabinetWidth:6,cabinetColor:15658734,cabinetDoorColor:413587,handleLength:1,handleWidth:.5,handleThickness:.5,handleMarginHorizontal:.5,handleMarginVertical:1,handleColor:2632749},e),this.setValues(e),this.init()};WorkBench.prototype=Object.assign(Object.create(THREE.Group.prototype),{constructor:WorkBench,init:function(){var e=new THREE.Mesh(new THREE.BoxGeometry(this.length,this.desktopThickness,this.width),new THREE.MeshPhongMaterial({color:this.desktopColor}));e.castShadow=!0,e.receiveShadow=!0,e.position.y+=(this.height-this.desktopThickness)/2,this.add(e);var t=new THREE.MeshPhongMaterial({color:this.cabinetColor}),i=new THREE.Mesh(new THREE.BoxGeometry(this.length-2*this.cabinetMarginSide,this.height-this.desktopThickness,this.cabinetThickness),t);i.castShadow=!0,i.receiveShadow=!0,i.position.y-=this.desktopThickness/2,i.position.z-=(this.width-2*this.cabinetMarginSide-this.cabinetThickness)/2,this.add(i);var a=new THREE.Group,n=new THREE.Mesh(new THREE.BoxGeometry(this.cabinetThickness,this.height-this.desktopThickness,this.width-2*this.cabinetMarginSide-this.cabinetThickness),t);n.castShadow=!0,n.receiveShadow=!0,n.position.x-=(this.cabinetWidth-this.cabinetThickness)/2,a.add(n);var o=n.clone();o.position.x+=this.cabinetWidth-this.cabinetThickness,a.add(o);var r=new THREE.Mesh(new THREE.BoxGeometry(this.cabinetWidth-2*this.cabinetThickness,this.cabinetThickness,this.width-2*this.cabinetMarginSide-this.cabinetThickness),t);r.castShadow=!0,r.receiveShadow=!0,r.position.y-=(this.height-this.desktopThickness-this.cabinetThickness)/2,a.add(r);var h=r.clone();h.position.y+=this.height-this.desktopThickness-this.cabinetThickness,a.add(h);var s=new THREE.Mesh(new THREE.BoxGeometry(this.cabinetWidth-2*this.cabinetThickness,this.height-this.desktopThickness-2*this.cabinetThickness,this.cabinetThickness),new THREE.MeshPhongMaterial({color:this.cabinetDoorColor}));s.castShadow=!0,s.receiveShadow=!0,s.position.z+=this.width/2-this.cabinetMarginSide-this.cabinetThickness,a.add(s),a.position.x-=(this.length-2*this.cabinetMarginSide-this.cabinetWidth)/2,a.position.y-=this.desktopThickness/2,a.position.z+=this.cabinetThickness/2,this.add(a);var l=a.clone();l.position.x+=this.length-2*this.cabinetMarginSide-this.cabinetWidth,this.add(l);var c=new THREE.Mesh(new THREE.BoxGeometry(this.handleWidth,this.handleLength,this.handleThickness),new THREE.MeshPhongMaterial({color:this.handleColor}));c.castShadow=!0,c.receiveShadow=!0,c.position.x-=this.length/2-this.cabinetMarginSide-this.cabinetWidth+this.cabinetThickness+this.handleMarginHorizontal+this.handleWidth/2,c.position.y+=this.height/2-this.desktopThickness-this.cabinetThickness-this.handleMarginVertical-this.handleLength/2,c.position.z+=(this.width-2*this.cabinetMarginSide+this.handleThickness)/2,this.add(c);var d=c.clone();d.position.x+=this.length+2*(this.cabinetThickness+this.handleMarginHorizontal-this.cabinetMarginSide-this.cabinetWidth)+this.handleWidth,this.add(d)},setValues:setValues});var Showcase=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};THREE.Group.call(this),e=Object.assign({length:26,width:6,height:8,row:2,column:5,caseColor:15658734,caseThickness:1,meterLength:1,meterThickness:1,meterColor:6535423},e),this.setValues(e),this.init()};Showcase.prototype=Object.assign(Object.create(THREE.Group.prototype),{constructor:Showcase,init:function(){var e=new THREE.MeshPhongMaterial({color:this.caseColor}),t=new THREE.Mesh(new THREE.BoxGeometry(this.length,this.height,this.caseThickness),e);t.castShadow=!0,t.receiveShadow=!0,t.position.z-=(this.width-this.caseThickness)/2,this.add(t);var i=new THREE.Mesh(new THREE.BoxGeometry(this.caseThickness,this.height,this.width-this.caseThickness),e);i.castShadow=!0,i.receiveShadow=!0,i.position.x-=(this.length-this.caseThickness)/2,i.position.z+=this.caseThickness/2,this.add(i);var a=i.clone();a.position.x+=this.length-this.caseThickness,this.add(a);var n=new THREE.Mesh(new THREE.BoxGeometry(this.length-2*this.caseThickness,this.caseThickness,this.width-this.caseThickness),e);n.castShadow=!0,n.receiveShadow=!0,n.position.y+=(this.height-this.caseThickness)/2,n.position.z+=this.caseThickness/2,this.add(n);var o=this.length-2*this.caseThickness,r=this.height-this.caseThickness,h=(o-this.column*this.meterLength)/this.column,s=(r-this.row*this.meterLength)/this.row,l=new THREE.Mesh(new THREE.BoxGeometry(this.meterLength,this.meterLength,this.meterThickness),new THREE.MeshPhongMaterial({color:this.meterColor}));l.castShadow=!0,l.receiveShadow=!0,l.position.x-=(this.length-h-2*this.caseThickness-this.meterLength)/2,l.position.y+=(this.height-s-2*this.caseThickness-this.meterLength)/2,l.position.z-=(this.width-2*this.caseThickness-this.meterThickness)/2;for(var c=0;c<this.row;c++)for(var d=0;d<this.column;d++){var g=l.clone();g.position.x+=d*(h+this.meterLength),g.position.y-=c*(s+this.meterLength),this.add(g)}},setValues:setValues});var Hint=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};THREE.Group.call(this),(e=Object.assign({text:"hello hint",font:"Microsoft YaHei",fontSize:48,fontStyle:"bold",fontColor:"#ffffff",strokeColor:"#ff4500",strokeWidth:2,wordInOneLine:5,lineHeight:48,hintMargin:3,axis:"y",timeout:3e3},e)).marginBottom=e.fontSize/4,e.scaleBasis=Math.ceil(e.text.length/e.wordInOneLine),this.setValues(e),this.visible=!1,this.init()};Hint.prototype=Object.assign(Object.create(THREE.Group.prototype),{constructor:Hint,init:function(){var e=document.createElement("canvas"),t=Math.ceil(this.text.length/this.wordInOneLine);e.width=this.fontSize*this.wordInOneLine,e.height=this.lineHeight*t+this.marginBottom;var i=e.getContext("2d");i.fillStyle=this.fontColor,i.strokeStyle=this.strokeColor,i.font=this.fontStyle+" "+this.fontSize+"px "+this.font,i.lineWidth=this.strokeWidth,i.wrapText(this.text,0,this.lineHeight,this.fontSize*this.wordInOneLine,this.lineHeight);var a=new THREE.Texture(e);a.needsUpdate=!0;var n=new THREE.Sprite(new THREE.SpriteMaterial({map:a,transparent:!0,depthWrite:!1}));n.renderOrder=1;var o=e.width/e.height;n.scale.set(this.scaleBasis*o,this.scaleBasis,1),this.add(n)},setValues:setValues,bindTo:function(e){Array.isArray(e)||(e=[e]);var t=e[e.length/2|0];this.position.fromArray(t.position.toArray()),this.position[this.axis]+=this.hintMargin;var i=this;e.map(function(e){e.isObject3D&&e.on("click",function(){i.visible||(i.visible=!0,setTimeout(function(){i.visible=!1},i.timeout))})})}}),CanvasRenderingContext2D.prototype.wrapText=function(e,t,i,a,n){if("string"==typeof e&&"number"==typeof t&&"number"==typeof i){var o=this,r=o.canvas;void 0===a&&(a=r&&r.width||300),void 0===n&&(n=r&&parseInt(window.getComputedStyle(r).lineHeight)||parseInt(window.getComputedStyle(document.body).lineHeight));for(var h=e.split(""),s="",l=0;l<h.length;l++){var c=s+h[l];a<o.measureText(c).width&&0<l?(o.fillText(s,t,i),o.strokeText(s,t,i),s=h[l],i+=n):s=c}o.fillText(s,t,i),o.strokeText(s,t,i)}};var Status=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};THREE.Group.call(this),e=Object.assign({nameText:"machine",statusText:"running",dataText:"10kW",font:"Microsoft YaHei",fontSizeMain:48,fontColorMain:"#333",fontSizeSecond:44,fontColorSecond:"#fff",backgroundColor:"#ffc000",marginX:40,marginY:15,magic:30,signGutter:20},e),this.setValues(e),this.init()};Status.prototype=Object.assign(Object.create(THREE.Group.prototype),{constructor:Status,init:function(){this.createTexture();var e=new THREE.Sprite(new THREE.SpriteMaterial({map:this.texture,transparent:!0,depthWrite:!1}));e.renderOrder=1;var t=this.w/this.h;e.scale.set(20*t,20,1),this.add(e)},setValues:setValues,bindTo:function(e){Array.isArray(e)||(e=[e]);var t=e[e.length/2|0];this.position.copy(t.position),this.position.y+=this.signGutter+t.geometry.parameters.height/2},calcWidth:function(e,t,i){var a=document.createElement("canvas").getContext("2d");a.font="bold ".concat(this.fontSizeMain,"px ").concat(this.font);var n=a.measureText(e).width;a.font="".concat(this.fontSizeSecond,"px ").concat(this.font);var o=a.measureText(t).width,r=a.measureText(i).width;return Math.max(n,o,r)},createTexture:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.name,i=void 0===t?this.nameText:t,a=e.status,n=void 0===a?this.statusText:a,o=e.data,r=void 0===o?this.dataText:o,h=Math.PI,s=document.createElement("canvas"),l=s.getContext("2d"),c=this.calcWidth(i,n,r)+2*this.marginX,d=this.fontSizeMain+2*this.fontSizeSecond+4*this.marginY+this.magic;this.w=s.width=c,this.h=s.height=d;var g=new Path2D;g.moveTo(c/2-this.magic/2,d-this.magic),g.arc(this.magic,d-2*this.magic,this.magic,h/2,h),g.arc(this.magic,this.magic,this.magic,h,1.5*h),g.arc(c-this.magic,this.magic,this.magic,1.5*h,0),g.arc(c-this.magic,d-2*this.magic,this.magic,0,h/2),g.lineTo(c/2+this.magic/2,d-this.magic),g.lineTo(c/2,d),g.lineTo(c/2-this.magic/2,d-this.magic),l.fillStyle=this.backgroundColor,l.fill(g),l.font="bold ".concat(this.fontSizeMain,"px ").concat(this.font),l.textAlign="center",l.textBaseline="bottom",l.fillStyle=this.fontColorMain;var w=this.fontSizeMain+this.marginY;l.fillText(i,c/2,w),l.font="".concat(this.fontSizeSecond,"px ").concat(this.font),l.fillStyle=this.fontColorSecond,w+=this.fontSizeSecond+this.marginY,l.fillText(n,c/2,w),w+=this.fontSizeSecond+this.marginY,l.fillText(r,c/2,w),this.texture=new THREE.CanvasTexture(s)}});var Sign=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};THREE.Group.call(this),e=Object.assign({nameText:"machine",statusText:"running",dataText:"10kW",font:"Microsoft YaHei",fontSizeMain:54,fontColorMain:"#333",fontSizeSecond:48,fontColorSecondOn:"#fff",fontColorSecondPause:"#fff",fontColorSecondOff:"#aaa",frameColorOn:697977,frameColorPause:16729344,frameColorOff:10855845,backgroundColorOn:6737322,backgroundColorPause:16760832,backgroundColorOff:15132390,marginX:25,marginY:15,magic:30,scaleRate:15,boardType:"on",wallHeight:30},e),this.setValues(e),this.visible=!1,this.init()};Sign.prototype=Object.assign(Object.create(THREE.Group.prototype),{constructor:Status,init:function(){this.width=this.calcWidth(this.nameText,this.statusText,this.dataText)+2*this.marginX,this.height=this.fontSizeMain+2*this.fontSizeSecond+4*this.marginY,this.createBoard(),this.createFace()},setValues:setValues,bindTo:function(e){Array.isArray(e)||(e=[e]);var t=e[e.length/2|0];this.position.copy(t.position),this.position.y=this.wallHeight+(this.height/2+this.magic)/this.scaleRate},calcWidth:function(e,t,i){var a=document.createElement("canvas").getContext("2d");a.font="bold ".concat(this.fontSizeMain,"px ").concat(this.font);var n=a.measureText(e).width;a.font="".concat(this.fontSizeSecond,"px ").concat(this.font);var o=a.measureText(t).width,r=a.measureText(i).width;return Math.max(n,o,r)},pickColor:function(){switch(this.boardType.toLowerCase()){case"pause":return{bg:this.backgroundColorPause,frame:this.frameColorPause,font:this.fontColorSecondPause};case"off":return{bg:this.backgroundColorOff,frame:this.frameColorOff,font:this.fontColorSecondOff};case"on":default:return{bg:this.backgroundColorOn,frame:this.frameColorOn,font:this.fontColorSecondOn}}},createBoard:function(){var e=Math.PI,t=this.magic/this.scaleRate,i=this.width/this.scaleRate,a=this.height/this.scaleRate,n=new THREE.Shape;n.moveTo(i/2-t/2,t),n.lineTo(t,t),n.arc(0,t,t,e/-2,e,!0),n.lineTo(0,a),n.arc(t,0,t,e,e/2,!0),n.lineTo(i-t,a+t),n.arc(0,-t,t,e/2,0,!0),n.lineTo(i,2*t),n.arc(-t,0,t,0,e/-2,!0),n.lineTo(i/2+t/2,t),n.lineTo(i/2,0),n.lineTo(i/2-t/2,t);var o=new THREE.ExtrudeGeometry(n,{steps:1,depth:t/4,bevelThickness:t/4,bevelSize:t/4}),r=this.getObjectByName("board");this.remove(r);var h=new THREE.MeshBasicMaterial({color:this.pickColor().bg}),s=new THREE.MeshBasicMaterial({color:this.pickColor().frame}),l=new THREE.Mesh(o,[h,s]);l.position.x-=i/2,l.position.y-=a/2+t,l.name="board",this.add(l)},createFace:function(){var e=document.createElement("canvas"),t=e.getContext("2d"),i=this.width,a=this.height;e.width=i,e.height=a,t.font="bold ".concat(this.fontSizeMain,"px ").concat(this.font),t.textAlign="center",t.textBaseline="bottom",t.fillStyle=this.fontColorMain;var n=this.fontSizeMain+this.marginY;t.fillText(this.nameText,i/2,n),t.font="".concat(this.fontSizeSecond,"px ").concat(this.font),t.fillStyle=this.pickColor().font,n+=this.fontSizeSecond+this.marginY,t.fillText(this.statusText,i/2,n),n+=this.fontSizeSecond+this.marginY,t.fillText(this.dataText,i/2,n);var o=new THREE.CanvasTexture(e),r=this.getObjectByName("front");this.remove(r);var h=new THREE.Mesh(new THREE.PlaneGeometry(.9*this.width/this.scaleRate,.9*this.height/this.scaleRate),new THREE.MeshBasicMaterial({map:o,transparent:!0,depthWrite:!1}));h.position.set(0,0,this.magic/this.scaleRate/2+.01),h.name="front",this.add(h);var s=this.getObjectByName("back");this.remove(s);var l=h.clone();l.rotation.y+=Math.PI,l.position.z=-this.magic/this.scaleRate/4-.01,l.name="back",this.add(l)},update:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.name,i=void 0===t?this.nameText:t,a=e.status,n=void 0===a?this.statusText:a,o=e.data,r=void 0===o?this.dataText:o,h=e.boardType,s=void 0===h?this.boardType:h;this.nameText=i,this.statusText=n,this.dataText=r,this.boardType=s,this.init()}});var Computer=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};THREE.Group.call(this),e=Object.assign({length:5,width:1.5,height:4,screenHeight:3,marginX:.2,marginY:.2,frameColor:6908265,image:"none",imageColor:13619151,imageThickness:.05},_objectSpread({},e,{thickness:e.width/3})),this.setValues(e),this.init()};Computer.prototype=Object.assign(Object.create(THREE.Group.prototype),{constructor:Computer,init:function(){var e,t=new THREE.MeshPhongMaterial({color:this.frameColor}),i=new THREE.Mesh(new THREE.BoxGeometry(this.length,this.screenHeight,this.thickness),t);if(i.castShadow=!0,i.receiveShadow=!0,i.position.y+=(this.height-this.screenHeight)/2,i.position.z+=(this.width-this.thickness)/2,this.add(i),"none"===this.image)e=new THREE.MeshBasicMaterial({color:this.imageColor});else{var a=(new THREE.TextureLoader).load(this.image);e=new THREE.MeshBasicMaterial({map:a})}var n=new THREE.Mesh(new THREE.PlaneGeometry(this.length-2*this.marginX,this.screenHeight-2*this.marginY),e);n.position.y+=(this.height-this.screenHeight)/2,n.position.z+=this.width/2+this.imageThickness,this.add(n);var o=new THREE.Mesh(new THREE.BoxGeometry(this.thickness,this.height/2,this.thickness),t);o.castShadow=!0,o.receiveShadow=!0,o.position.y+=this.thickness-this.height/4,this.add(o);var r=new THREE.Mesh(new THREE.BoxGeometry(3*this.thickness,this.thickness,3*this.thickness),t);r.castShadow=!0,r.receiveShadow=!0,r.position.y+=(this.thickness-this.height)/2,this.add(r)},setValues:setValues});var scene,camera,renderer,controls,threeEvent,animatingAction,Data={refreshInterval:5e3},Camera={distance:60,altitude:40,gazeTime:3e3},Corridor={width:4},Wall={height:30,thickness:2,lengthLong:80,lengthShort1:12,lengthShort2:2,opacity:.7},Floor={thickness:.5,lengthUp:80,widthUp:20},Door={height:26,thickness:.2,opacity:.4,widthEntry:12,gapEntry:4,widthExit:12,gapExit:14,widthSecondary:12,gapSecondary:4},Board={lengthUp:30,lengthDown:22,lengthVertical:30,lengthSecondary:12,thickness:1,height:12,heightSecondary:8,heightTv:6,altitude:15,intervalUp:6,intervalDown:2,intervalSecondary:3,gapUp:4,gapDown:16,gapVertical:14,gapSecondaryRight:2,gapSecondaryDown:4,gapSecondaryLeft:21.5},PC={length:5,width:1.5,height:4},Device={length:2,width:1.5,height:1},Adapter={length:1,width:1,height:.5},Area1={deskLength:20,deskWidth:8,deskHeight:9,deskGap:3,pcMargin:2,deviceInterval:.5,deviceMargin:1},Area2={deskLength:20,deskWidth:8,deskHeight:9,deskGap:3,pcMargin:2},Area3={barrelRadius:7,barrelHeight:20,barrelGapVertical:3,barrelGapHorizontal:2,machineLength:28,machineWidth:12,machineHeight:20,tubeAltitude:17,tubeRadius:.5},Area4={cabinetLength:8,cabinetWidth:6,cabinetHeight:17,cabinetGapVertical:3,cabinetGapHorizontal:3},Area5={deskLength:28,deskWidth:8,deskHeight:9,deskGap:3},Area6={deskLength:22,deskWidth:7,deskHeight:9,deskGapHorizontal:4,deskGapVertical:13,workbenchLength:24,workbenchWidth:8,workbenchHeight:9,workbenchGapHorizontal:12,workbenchGapVertical:3,showcaseMargin:2,showcaseHeight:6,cabinetLength:8,cabinetWidth:7,cabinetHeight:21,cabinetGapHorizontal:2,cabinetGapVertical:3},Area7={workbenchLength:22,workbenchWidth:8,workbenchHeight:9,workbenchGapHorizontal:20,workbenchGapVertical:3,showcaseMargin:2,showcaseHeight:6},Area8={workbenchLength:28,workbenchWidth:8,workbenchHeight:9,workbenchGap:3},Area9={cabinetAcLength:8,cabinetAcWidth:8,cabinetAcHeight:24,cabinetDcLength:8,cabinetDcWidth:6,cabinetDcHeight:19,cabinetMargin:2,cabinetGapHorizontal:3,cabinetGapVertical:24},Area10={cabinetLength:8,cabinetWidth:8,cabinetHeight:21,cabinetMargin:2,cabinetGapHorizontal:3,cabinetGapVertical:3},Area11={cabinetLength:10,cabinetWidth:8,cabinetHeight:16,cabinetGapHorizontal:3,cabinetGapVertical:3,conditionerLength:8,conditionerWidth:6,conditionerHeight:20,conditionerGap:3,conditionerMargin:2,fridgeLength:8,fridgeWidth:7,fridgeHeight:18,fridgeGap:3,fridgeMargin:2,heaterRadius:3,heaterHeight:14,heaterGap:5,heaterMargin:2,deskLength:20,deskWidth:8,deskHeight:9,deskGapHorizontal:17,deskGapVertical:3},Area12={fridgeLength:8,fridgeWidth:6,fridgeHeight:20,fridgeGapHorizontal:4,fridgeGapVertical:8,conditionerLength:11,conditionerWidth:3,conditionerHeight:4,conditionerAltitude:24,heaterRadius:2.5,heaterLength:11,heaterAltitude:24,heaterMargin:3,deskLength:9,deskWidth:8,deskHeight:9,deskGapHorizontal:3,deskGapVertical:15},clock=new THREE.Clock,animateActions={},cameraInitPosition=new THREE.Vector3(Wall.lengthLong/2+Wall.thickness,2.8*Wall.height,1.8*Wall.lengthLong),cameraInitTarget=new THREE.Vector3(Wall.lengthLong/2+Wall.thickness,0,Wall.lengthLong/2),routine=[],iterator=-1,iteratorRoutine=-1,signs=[];function draw(){initScene(),initCamera(),initRenderer(),initLights(),initFloor(),initGround(),initWalls(),initDoors(),initShowBoards(),initArea1(),initArea2(),initArea3(),initArea4(),initArea5(),initArea6(),initArea7(),initArea8(),initArea9(),initArea10(),initArea11(),initArea12(),initRoutine(),initControls(),queryData(),animate(),window.addEventListener("resize",onWindowResize,!1)}function initScene(){scene=new THREE.Scene}function initCamera(){(camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3)).position.copy(cameraInitPosition)}function initRenderer(){(renderer=new THREE.WebGLRenderer({antialias:!0})).setSize(window.innerWidth,window.innerHeight),renderer.setClearColor(16774638),renderer.shadowMap.enabled=!0,renderer.shadowMap.type=THREE.PCFSoftShadowMap,document.body.appendChild(renderer.domElement),threeEvent=new THREE.onEvent(scene,camera)}function initLights(){var e=new THREE.AmbientLight(Colors.white,.7);scene.add(e);var t=new THREE.PointLight(Colors.white,.4);t.position.set(Wall.lengthLong+1.5*Wall.thickness,3*Wall.height,Wall.lengthLong/2),t.castShadow=!0,t.shadow.mapSize.width=1024,t.shadow.mapSize.height=1024,scene.add(t)}function initFloor(){var e=new THREE.MeshPhongMaterial({color:13619151}),t=new THREE.Mesh(new THREE.BoxGeometry(Floor.lengthUp,Floor.thickness,Floor.widthUp),e);t.receiveShadow=!0,t.position.set(2*Wall.thickness+1.5*Wall.lengthLong,Floor.thickness/2,Wall.thickness+Floor.widthUp/2),scene.add(t)}function initGround(){var e=(new THREE.TextureLoader).load("img/texture/texture_ground.jpg");e.wrapS=e.wrapT=THREE.RepeatWrapping,e.offset.set(0,0),e.repeat.set(16,8);var t=new THREE.Mesh(new THREE.BoxGeometry(3*Wall.lengthLong+4*Wall.thickness+2*Corridor.width,Wall.thickness,Wall.lengthLong+2*Corridor.width),new THREE.MeshPhongMaterial({color:14540253,map:e}));t.position.set(Wall.lengthLong/2+Wall.thickness,Wall.thickness/-2,Wall.lengthLong/2),t.receiveShadow=!0,scene.add(t)}function initWalls(){var e=new THREE.MeshPhongMaterial({color:11320775,transparent:!0,opacity:Wall.opacity}),t=new THREE.BoxGeometry(Wall.thickness,Wall.height,Wall.lengthLong),i=new THREE.BoxGeometry(Wall.lengthLong,Wall.height,Wall.thickness),a=new THREE.Mesh(new THREE.BoxGeometry(Wall.thickness,Wall.height,Wall.thickness+Door.gapExit),e);a.castShadow=!0,a.receiveShadow=!0,a.position.set(Wall.thickness/2,Wall.height/2,(Wall.thickness+Door.gapExit)/2),scene.add(a);var n=new THREE.Mesh(new THREE.BoxGeometry(Wall.thickness,Wall.height-Door.height,Door.widthExit),e);n.castShadow=!0,n.receiveShadow=!0,n.position.set(Wall.thickness/2,(Wall.height+Door.height)/2,Wall.thickness+Door.gapExit+Door.widthExit/2),scene.add(n);var o=new THREE.Mesh(new THREE.BoxGeometry(Wall.thickness,Wall.height,Wall.lengthLong-Wall.thickness-Door.gapExit-Door.widthExit),e);o.castShadow=!0,o.receiveShadow=!0,o.position.set(Wall.thickness/2,Wall.height/2,(Wall.lengthLong+Door.widthExit+Wall.thickness+Door.gapExit)/2),scene.add(o);var r=new THREE.Mesh(t,e);r.castShadow=!0,r.receiveShadow=!0,r.position.set(2*Wall.lengthLong+2.5*Wall.thickness,Wall.height/2,Wall.lengthLong/2),scene.add(r);var h=new THREE.Mesh(i,e);h.castShadow=!0,h.receiveShadow=!0,h.position.set(Wall.lengthLong/2+Wall.thickness,Wall.height/2,Wall.thickness/2),scene.add(h);var s=new THREE.Mesh(i,e);s.castShadow=!0,s.receiveShadow=!0,s.position.set(1.5*Wall.lengthLong+2*Wall.thickness,Wall.height/2,Wall.thickness/2),scene.add(s);var l=new THREE.Mesh(i,e);l.castShadow=!0,l.receiveShadow=!0,l.position.set(Wall.lengthLong/2+Wall.thickness,Wall.height/2,Wall.lengthLong-Wall.thickness/2),scene.add(l);var c=new THREE.Mesh(new THREE.BoxGeometry(Wall.lengthLong-Door.widthEntry-Door.gapEntry,Wall.height,Wall.thickness),e);c.castShadow=!0,c.receiveShadow=!0,c.position.set((Wall.lengthLong-Door.widthEntry-Door.gapEntry)/2+Wall.lengthLong+2*Wall.thickness,Wall.height/2,Wall.lengthLong-Wall.thickness/2),scene.add(c);var d=new THREE.Mesh(new THREE.BoxGeometry(Door.widthEntry,Wall.height-Door.height,Wall.thickness),e);d.castShadow=!0,d.receiveShadow=!0,d.position.set(2*Wall.lengthLong+2*Wall.thickness-Door.gapEntry-Door.widthEntry/2,(Wall.height+Door.height)/2,Wall.lengthLong-Wall.thickness/2),scene.add(d);var g=new THREE.Mesh(new THREE.BoxGeometry(Door.gapEntry,Wall.height,Wall.thickness),e);g.castShadow=!0,g.receiveShadow=!0,g.position.set(2*Wall.lengthLong+2*Wall.thickness-Door.gapEntry/2,Wall.height/2,Wall.lengthLong-Wall.thickness/2),scene.add(g);var w=new THREE.Mesh(new THREE.BoxGeometry(Wall.thickness,Wall.height,Wall.lengthShort1),e);w.castShadow=!0,w.receiveShadow=!0,w.position.set(Wall.lengthLong+1.5*Wall.thickness,Wall.height/2,Wall.lengthShort1/2),scene.add(w);var p=new THREE.Mesh(new THREE.BoxGeometry(Wall.thickness,Wall.height,Wall.lengthShort2),e);p.castShadow=!0,p.receiveShadow=!0,p.position.set(Wall.lengthLong+1.5*Wall.thickness,Wall.height/2,Wall.lengthLong-Wall.lengthShort2/2),scene.add(p);var E=new THREE.Mesh(i,e);E.castShadow=!0,E.receiveShadow=!0,E.position.set(Wall.lengthLong/-2,Wall.height/2,Wall.thickness/2),scene.add(E);var k=new THREE.Mesh(t,e);k.castShadow=!0,k.receiveShadow=!0,k.position.set(-Wall.lengthLong-Wall.thickness/2,Wall.height/2,Wall.lengthLong/2),scene.add(k);var T=new THREE.Mesh(new THREE.BoxGeometry(Door.gapSecondary,Wall.height,Wall.thickness),e);T.castShadow=!0,T.receiveShadow=!0,T.position.set(Door.gapSecondary/2-Wall.lengthLong,Wall.height/2,Wall.lengthLong-Wall.thickness/2),scene.add(T);var W=new THREE.Mesh(new THREE.BoxGeometry(Door.widthSecondary,Wall.height-Door.height,Wall.thickness),e);W.castShadow=!0,W.receiveShadow=!0,W.position.set(Door.gapSecondary+Door.widthSecondary/2-Wall.lengthLong,(Wall.height+Door.height)/2,Wall.lengthLong-Wall.thickness/2),scene.add(W);var u=new THREE.Mesh(new THREE.BoxGeometry(Wall.lengthLong-Door.gapSecondary-Door.widthSecondary,Wall.height,Wall.thickness),e);u.castShadow=!0,u.receiveShadow=!0,u.position.set((Wall.lengthLong-Door.gapSecondary-Door.widthSecondary)/-2,Wall.height/2,Wall.lengthLong-Wall.thickness/2),scene.add(u)}function initDoors(){var e=new THREE.MeshLambertMaterial({color:1602765,opacity:Door.opacity,transparent:!0,depthWrite:!1}),t=new THREE.Mesh(new THREE.BoxGeometry(Door.widthEntry,Door.height,Door.thickness),e);t.name="door-entry",t.castShadow=!0,t.renderOrder=1,t.position.set(2*Wall.lengthLong+2*Wall.thickness-Door.gapEntry-Door.widthEntry/2,Door.height/2,Wall.lengthLong-Wall.thickness/2),scene.add(t),addAnimation({meshObject:t,name:"door-entry-action",timeArray:[0,.5,1],frames:[{property:"door-entry.rotation[y]",values:[0,Math.PI/-4,Math.PI/-2]},{property:"door-entry.position",values:[2*Wall.lengthLong+2*Wall.thickness-Door.gapEntry-Door.widthEntry/2,Door.height/2,Wall.lengthLong-Wall.thickness/2,2*Wall.lengthLong+2*Wall.thickness-Door.gapEntry-Door.widthEntry/2/Math.sqrt(2),Door.height/2,Wall.lengthLong-Wall.thickness/2-Door.widthEntry/2/Math.sqrt(2),2*Wall.lengthLong+2*Wall.thickness-Door.gapEntry-Door.thickness/2,Door.height/2,Wall.lengthLong-Wall.thickness/2-Door.widthEntry/2]}],loop:THREE.LoopPingPong,loopCount:2,loopCallback:function(e){e.action.paused=!0}}),t.on("click",function(){switchAnimating("door-entry-action")});var i=new THREE.Mesh(new THREE.BoxGeometry(Door.thickness,Door.height,Door.widthExit),e);i.name="door-exit",i.castShadow=!0,i.renderOrder=1,i.position.set(Wall.thickness/2,Door.height/2,Wall.thickness+Door.gapExit+Door.widthExit/2),scene.add(i),addAnimation({meshObject:i,name:"door-exit-action",timeArray:[0,.5,1],frames:[{property:"door-exit.rotation[y]",values:[0,Math.PI/-4,Math.PI/-2]},{property:"door-exit.position",values:[Wall.thickness/2,Door.height/2,Wall.thickness+Door.gapExit+Door.widthExit/2,Wall.thickness/2+Door.widthExit/2/Math.sqrt(2),Door.height/2,Wall.thickness+Door.gapExit+Door.widthExit-Door.widthExit/2/Math.sqrt(2),Wall.thickness/2+Door.widthExit/2,Door.height/2,Wall.thickness+Door.gapExit+Door.widthExit-Door.thickness/2]}],loop:THREE.LoopPingPong,loopCount:2,loopCallback:function(e){e.action.paused=!0}}),i.on("click",function(){switchAnimating("door-exit-action")});var a=new THREE.Mesh(new THREE.BoxGeometry(Door.widthSecondary,Door.height,Door.thickness),e);a.name="door-secondary",a.castShadow=!0,a.renderOrder=1,a.position.set(Door.gapSecondary+Door.widthSecondary/2-Wall.lengthLong,Door.height/2,Wall.lengthLong-Wall.thickness/2),scene.add(a),addAnimation({meshObject:a,name:"door-secondary-action",timeArray:[0,.5,1],frames:[{property:"door-secondary.rotation[y]",values:[0,Math.PI/4,Math.PI/2]},{property:"door-secondary.position",values:[Door.gapSecondary+Door.widthSecondary/2-Wall.lengthLong,Door.height/2,Wall.lengthLong-Wall.thickness/2,Door.gapSecondary+Door.widthSecondary/2/Math.sqrt(2)-Wall.lengthLong,Door.height/2,Wall.lengthLong-Wall.thickness/2-Door.widthSecondary/2/Math.sqrt(2),Door.gapSecondary+Door.thickness/2-Wall.lengthLong,Door.height/2,Wall.lengthLong-Wall.thickness/2-Door.widthSecondary/2]}],loop:THREE.LoopPingPong,loopCount:2,loopCallback:function(e){e.action.paused=!0}}),a.on("click",function(){switchAnimating("door-secondary-action")})}function initShowBoards(){var e=new ShowBoard({length:Board.lengthUp,boardImg:"img/showBoard/show_board_1.jpg"});e.position.set(Board.gapUp+Board.lengthUp/2+Wall.thickness,Board.altitude+Board.height/2,Wall.thickness+Board.thickness/2),scene.add(e);var t=new ShowBoard({length:Board.lengthUp,boardImg:"img/showBoard/show_board_2.png"});t.position.set(Board.gapUp+1.5*Board.lengthUp+Wall.thickness+Board.intervalUp,Board.altitude+Board.height/2,Wall.thickness+Board.thickness/2),scene.add(t);var i=new ShowBoard({length:Board.lengthDown,boardImg:"img/showBoard/show_board_3.png"});i.position.set(Wall.lengthLong+2*Wall.thickness+Board.gapDown+Board.lengthDown/2,Board.altitude+Board.height/2,Wall.lengthLong-Wall.thickness-Board.thickness/2),i.rotation.y=Math.PI,scene.add(i);var a=new ShowBoard({length:Board.lengthDown,boardImg:"img/showBoard/show_board_4.png"});a.position.set(Wall.lengthLong+2*Wall.thickness+Board.gapDown+1.5*Board.lengthDown+Board.intervalDown,Board.altitude+Board.height/2,Wall.lengthLong-Wall.thickness-Board.thickness/2),a.rotation.y=Math.PI,scene.add(a);var n=new ShowBoard({length:Board.lengthVertical,boardImg:"img/showBoard/show_board_5.png"});n.position.set(2*Wall.lengthLong+2*Wall.thickness-Board.thickness/2,Board.altitude+Board.height/2,Wall.lengthLong-Wall.thickness-Board.gapVertical-Board.lengthVertical/2),n.rotation.y=Math.PI/-2,scene.add(n);var o=new ShowBoard({length:Board.lengthSecondary,height:Board.heightSecondary,marginX:.5});o.position.set(-Board.thickness/2,Board.altitude+Board.heightSecondary/2,Wall.thickness+Door.gapExit+Door.widthExit+Board.gapSecondaryRight+Board.lengthSecondary/2),o.rotation.y=Math.PI/-2,scene.add(o);var r=new ShowBoard({length:Board.lengthSecondary,height:Board.heightSecondary,marginX:.5});r.position.set(-Board.gapSecondaryDown-Board.lengthSecondary/2,Board.altitude+Board.heightSecondary/2,Wall.lengthLong-Wall.thickness-Board.thickness/2),r.rotation.y=Math.PI,scene.add(r);var h=new ShowBoard({length:Board.lengthSecondary,height:Board.heightTv,boardImg:"none"});h.position.set(-Board.gapSecondaryDown-Board.intervalSecondary-1.5*Board.lengthSecondary,Board.altitude+Board.heightTv/2,Wall.lengthLong-Wall.thickness-Board.thickness/2),h.rotation.y=Math.PI,scene.add(h);var s=new ShowBoard({length:Board.lengthSecondary,height:Board.heightTv,boardImg:"none"});s.position.set(-Board.gapSecondaryDown-2*Board.intervalSecondary-2.5*Board.lengthSecondary,Board.altitude+Board.heightTv/2,Wall.lengthLong-Wall.thickness-Board.thickness/2),s.rotation.y=Math.PI,scene.add(s);var l=new ShowBoard({length:Board.lengthSecondary,height:Board.heightSecondary,marginX:.5});l.position.set(-Board.gapSecondaryDown-3*Board.intervalSecondary-3.5*Board.lengthSecondary,Board.altitude+Board.heightSecondary/2,Wall.lengthLong-Wall.thickness-Board.thickness/2),l.rotation.y=Math.PI,scene.add(l);var c=new ShowBoard({length:Board.lengthSecondary,height:Board.heightSecondary,marginX:.5});c.position.set(Board.thickness/2-Wall.lengthLong,Board.altitude+Board.heightSecondary/2,Wall.thickness+Board.gapSecondaryLeft+Board.lengthSecondary/2),c.rotation.y=Math.PI/2,scene.add(c)}function initArea1(){var e=Wall.lengthLong+2*Wall.thickness+Board.gapDown+1.5*Board.lengthDown+Board.intervalDown,t=new Desk({length:Area1.deskLength,height:Area1.deskHeight,width:Area1.deskWidth});t.position.set(e,Area1.deskHeight/2,Wall.lengthLong-Wall.thickness-Area1.deskGap-Area1.deskWidth/2),scene.add(t);var i=new Computer({length:PC.length,width:PC.width,height:PC.height});i.position.set(e,Area1.deskHeight+PC.height/2,Wall.lengthLong-Wall.thickness-Area1.deskGap-Area1.deskWidth+Area1.pcMargin+PC.width/2),i.rotation.y=Math.PI,scene.add(i);var a=new THREE.Mesh(new THREE.BoxGeometry(Device.length,Device.height,Device.width),new THREE.MeshPhongMaterial({color:Colors.Device}));a.castShadow=!0,a.receiveShadow=!0,a.position.set(e-Area1.deskLength/2+Area1.deviceMargin+Device.length/2,Area1.deskHeight+Device.height/2,Wall.lengthLong-Wall.thickness-Area1.deskGap-Area1.deviceMargin-Device.width/2),scene.add(a);var n=a.clone();n.position.x+=Device.length+Area1.deviceInterval,scene.add(n);var o=n.clone();o.position.x+=Device.length+Area1.deviceInterval,scene.add(o);var r=a.clone();r.position.z-=Device.width+Area1.deviceInterval,scene.add(r);var h=r.clone();h.position.x+=Device.length+Area1.deviceInterval,scene.add(h);var s=new Hint({text:"需求响应终端",wordInOneLine:3});s.bindTo([o,n,a,r,h]),scene.add(s);var l=new THREE.Mesh(new THREE.BoxGeometry(Adapter.length,Adapter.height,Adapter.width),new THREE.MeshPhongMaterial({color:2374722}));l.castShadow=!0,l.receiveShadow=!0,l.position.set(e+Area1.deskLength/2-Area1.deviceMargin-Adapter.length/2,Area1.deskHeight+Adapter.height/2,Wall.lengthLong-Wall.thickness-Area1.deskGap-Area1.deviceMargin-Adapter.width/2),scene.add(l);var c=l.clone();c.position.x-=Adapter.length+Area1.deviceInterval,scene.add(c);var d=c.clone();d.position.x-=Adapter.length+Area1.deviceInterval,scene.add(d);var g=l.clone();g.position.z-=Adapter.width+Area1.deviceInterval,scene.add(g);var w=g.clone();w.position.x-=Adapter.length+Area1.deviceInterval,scene.add(w);var p=new Hint({text:"通信适配器",wordInOneLine:5,hintMargin:2});p.bindTo([d,c,l,g,w]),scene.add(p),routine[0]={targetPos:t.position.clone(),direction:"s"}}function initArea2(){var e=Wall.lengthLong+2*Wall.thickness+Board.gapDown+Board.lengthDown/2,t=new Desk({length:Area2.deskLength,height:Area2.deskHeight,width:Area2.deskWidth});t.position.set(e,Area2.deskHeight/2,Wall.lengthLong-Wall.thickness-Area2.deskGap-Area2.deskWidth/2),scene.add(t);var i=new Sign({nameText:"OpenADR",statusText:"运行",dataText:"2kW"});i.name="sign-area2-adr",i.bindTo(t),scene.add(i),signs.push(i);var a=new Computer({length:PC.length,width:PC.width,height:PC.height});a.position.set(e,Area2.deskHeight+PC.height/2,Wall.lengthLong-Wall.thickness-Area2.deskGap-Area2.deskWidth+Area2.pcMargin+PC.width/2),a.rotation.y=Math.PI,scene.add(a);var n=(Area2.deskLength-5*Device.length)/5,o=new THREE.Mesh(new THREE.BoxGeometry(Device.length,Device.height,Device.width),new THREE.MeshPhongMaterial({color:Colors.Device}));o.castShadow=!0,o.receiveShadow=!0,o.position.set(e-(Area2.deskLength-n-Device.length)/2,Area2.deskHeight+Device.height/2,Wall.lengthLong-Wall.thickness-Area2.deskGap-n/2-Device.width/2),scene.add(o);for(var r=[o],h=1;h<=4;h++){var s=o.clone();s.position.x+=h*(n+Device.length),scene.add(s),r.push(s)}var l=new Hint({text:"需求响应终端",wordInOneLine:3});l.bindTo(r),scene.add(l),routine[1]={targetPos:t.position.clone(),direction:"s",signs:[i]}}function initArea3(){var e=new THREE.TextureLoader,t=e.load("img/texture/texture_barrel.jpg");t.wrapS=t.wrapT=THREE.RepeatWrapping,t.offset.set(.5,0),t.repeat.set(1,2);var i=new THREE.MeshPhongMaterial({map:t}),a=new THREE.Mesh(new THREE.CylinderGeometry(Area3.barrelRadius,Area3.barrelRadius,Area3.barrelHeight,32),i);a.castShadow=!0,a.receiveShadow=!0,a.position.set(Wall.lengthLong+2*Wall.thickness+Area3.barrelGapHorizontal+Area3.barrelRadius,Area3.barrelHeight/2+Floor.thickness,Wall.thickness+Area3.barrelGapVertical+Area3.barrelRadius),scene.add(a);var n=new Sign({nameText:"蓄热空调",statusText:"运行",dataText:"10kW"});n.name="sign-area3-heat-barrel",n.bindTo(a),scene.add(n),signs.push(n);var o=a.clone();o.position.x=2*Wall.lengthLong+2*Wall.thickness-Area3.barrelGapHorizontal-Area3.barrelRadius,scene.add(o);var r=new Sign({nameText:"蓄冷空调",statusText:"停机",dataText:"0kW",offline:!0});r.name="sign-area3-ice-barrel",r.bindTo(o),scene.add(r),signs.push(r);var h=e.load("img/texture/texture_machine.jpg"),s=new THREE.MeshPhongMaterial({color:5728870}),l=[s,s,s,s,new THREE.MeshPhongMaterial({map:h}),s],c=new THREE.Mesh(new THREE.BoxGeometry(Area3.machineLength,Area3.machineHeight,Area3.machineWidth),l);c.castShadow=!0,c.receiveShadow=!0,c.position.set(1.5*Wall.lengthLong+2*Wall.thickness,Area3.machineHeight/2+Floor.thickness,Wall.thickness+Area3.barrelGapVertical+Area3.barrelRadius),scene.add(c);var d=new THREE.Mesh(new THREE.CylinderGeometry(Area3.tubeRadius,Area3.tubeRadius,Wall.lengthLong-Area3.barrelGapHorizontal-Area3.barrelGapHorizontal-2*Area3.barrelRadius,20),new THREE.MeshPhongMaterial({color:12500670}));d.castShadow=!0,d.receiveShadow=!0,d.rotation.z=Math.PI/2,d.position.set(1.5*Wall.lengthLong+2*Wall.thickness,Area3.tubeAltitude+Area3.tubeRadius/2,Wall.thickness+Area3.barrelGapVertical+Area3.barrelRadius),scene.add(d),routine[3]={targetPos:c.position.clone(),direction:"w",signs:[n,r]}}function initArea4(){var e=(new THREE.TextureLoader).load("img/texture/texture_rlc.jpg"),t=new THREE.MeshPhongMaterial({color:9543076}),i=[t,t,t,t,t,new THREE.MeshPhongMaterial({map:e})],a=new THREE.Mesh(new THREE.BoxGeometry(Area4.cabinetLength,Area4.cabinetHeight,Area4.cabinetWidth),i);a.castShadow=!0,a.receiveShadow=!0,a.position.set(Wall.lengthLong+2*Wall.thickness+Area4.cabinetGapHorizontal+Area4.cabinetLength/2,Area4.cabinetHeight/2,Wall.lengthLong-Wall.thickness-Area4.cabinetGapVertical-Area4.cabinetWidth/2),scene.add(a);var n=new Sign({nameText:"可调负载",statusText:"运行",dataText:"5kW"});n.name="sign-area4-rlc",n.bindTo(a),scene.add(n),signs.push(n),routine[2]={targetPos:a.position.clone(),direction:"s",signs:[n]}}function initArea5(){var e=Board.gapUp+1.5*Board.lengthUp+Wall.thickness+Board.intervalUp,t=new Desk({length:Area5.deskLength,height:Area5.deskHeight,width:Area5.deskWidth});t.position.set(e,Area5.deskHeight/2,Wall.thickness+Area5.deskGap+Area5.deskWidth/2),scene.add(t);var i=new Computer({length:PC.length,width:PC.width,height:PC.height});i.position.set(e,Area5.deskHeight+PC.height/2,Wall.thickness+Area5.deskGap+Area5.deskWidth/2),scene.add(i),routine[4]={targetPos:t.position.clone(),direction:"w"}}function initArea6(){var e=new WorkBench({length:Area6.workbenchLength,height:Area6.workbenchHeight,width:Area6.workbenchWidth});e.position.set(Wall.lengthLong+Wall.thickness-Area6.workbenchGapHorizontal-Area6.workbenchLength/2,Area6.workbenchHeight/2,Wall.lengthLong-Wall.thickness-Area6.workbenchGapVertical-Area6.workbenchWidth/2),e.rotation.y=Math.PI,scene.add(e);var t=new Showcase({length:Area6.workbenchLength-2*Area6.showcaseMargin,height:Area6.showcaseHeight,width:Area6.workbenchWidth-2*Area6.showcaseMargin});t.position.set(Wall.lengthLong+Wall.thickness-Area6.workbenchGapHorizontal-Area6.workbenchLength/2,Area6.workbenchHeight+Area6.showcaseHeight/2,Wall.lengthLong-Wall.thickness-Area6.workbenchGapVertical-Area6.workbenchWidth/2),t.rotation.y=Math.PI,scene.add(t);var i=new THREE.MeshPhongMaterial({color:13421772}),a=[i,i,i,i,i,new THREE.MeshPhongMaterial({map:(new THREE.TextureLoader).load("img/texture/texture_pressure.jpg")})],n=new THREE.Mesh(new THREE.BoxGeometry(Area6.cabinetLength,Area6.cabinetHeight,Area6.cabinetWidth),a);n.castShadow=!0,n.receiveShadow=!0,n.position.set(Wall.lengthLong+Wall.thickness-Area6.cabinetGapHorizontal-Area6.cabinetLength/2,Area6.cabinetHeight/2,Wall.lengthLong-Wall.thickness-Area6.cabinetGapVertical-Area6.cabinetWidth/2),scene.add(n);var o=new Desk({length:Area6.deskLength,height:Area6.deskHeight,width:Area6.deskWidth});o.position.set(Wall.lengthLong+Wall.thickness-Area6.deskGapHorizontal-Area6.deskLength/2,Area6.deskHeight/2,Wall.lengthLong-Wall.thickness-Area6.deskGapVertical-Area6.deskWidth/2),scene.add(o);var r=new Computer({length:PC.length,width:PC.width,height:PC.height});r.position.set(Wall.lengthLong+Wall.thickness-Area6.deskGapHorizontal-Area6.deskLength/2,Area6.deskHeight+PC.height/2,Wall.lengthLong-Wall.thickness-Area6.deskGapVertical-Area6.deskWidth/2),r.rotation.y=Math.PI,scene.add(r),routine[6]={targetPos:o.position.clone(),direction:"s"}}function initArea7(){var e=new WorkBench({length:Area7.workbenchLength,height:Area7.workbenchHeight,width:Area7.workbenchWidth});e.position.set(Wall.thickness+Area7.workbenchGapHorizontal+Area7.workbenchLength/2,Area7.workbenchHeight/2,Wall.lengthLong-Wall.thickness-Area7.workbenchGapVertical-Area7.workbenchWidth/2),e.rotation.y=Math.PI,scene.add(e);var t=new Showcase({length:Area7.workbenchLength-2*Area7.showcaseMargin,height:Area7.showcaseHeight,width:Area7.workbenchWidth-2*Area7.showcaseMargin});t.position.set(Wall.thickness+Area7.workbenchGapHorizontal+Area7.workbenchLength/2,Area7.showcaseHeight/2+Area7.workbenchHeight,Wall.lengthLong-Wall.thickness-Area7.workbenchGapVertical-Area7.workbenchWidth/2),t.rotation.y=Math.PI,scene.add(t),routine[7]={targetPos:e.position.clone(),direction:"s"}}function initArea8(){var e=new WorkBench({length:Area8.workbenchLength,height:Area8.workbenchHeight,width:Area8.workbenchWidth});e.position.set(Board.gapUp+Board.lengthUp/2+Wall.thickness,Area8.workbenchHeight/2,Wall.thickness+Area8.workbenchGap+Area8.workbenchWidth/2),scene.add(e);var t=new Computer({length:PC.length,width:PC.width,height:PC.height});t.position.set(Board.gapUp+Board.lengthUp/2+Wall.thickness,Area8.workbenchHeight+PC.height/2,Wall.thickness+Area8.workbenchGap+Area8.workbenchWidth/2),scene.add(t),routine[5]={targetPos:e.position.clone(),direction:"w"}}function initArea9(){var e=new THREE.TextureLoader,t=new THREE.MeshPhongMaterial({color:14869730}),i=[new THREE.MeshPhongMaterial({map:e.load("img/texture/texture_ac.jpg")}),t,t,t,t,t],a=new THREE.Mesh(new THREE.BoxGeometry(Area9.cabinetAcLength,Area9.cabinetAcHeight,Area9.cabinetAcWidth),i);a.castShadow=!0,a.receiveShadow=!0,a.position.set(Wall.thickness+Area9.cabinetGapHorizontal+Area9.cabinetAcLength/2,Area9.cabinetAcHeight/2,Wall.lengthLong-Wall.thickness-Area9.cabinetGapVertical-Area9.cabinetAcWidth/2),scene.add(a);var n=new THREE.MeshPhongMaterial({color:10131359}),o=[new THREE.MeshPhongMaterial({map:e.load("img/texture/texture_dc.jpg")}),n,n,n,n,n],r=new THREE.Mesh(new THREE.BoxGeometry(Area9.cabinetDcWidth,Area9.cabinetDcHeight,Area9.cabinetDcLength),o);r.castShadow=!0,r.receiveShadow=!0,r.position.set(Wall.thickness+Area9.cabinetGapHorizontal+Area9.cabinetDcWidth/2,Area9.cabinetDcHeight/2,Wall.lengthLong-Wall.thickness-Area9.cabinetGapVertical-Area9.cabinetAcWidth-Area9.cabinetMargin-Area9.cabinetDcLength/2),scene.add(r);var h=a.position.clone();h.z=(a.position.z+r.position.z)/2,routine[9]={targetPos:h,direction:"a"}}function initArea10(){var e=new THREE.MeshPhongMaterial({color:Colors.dark}),t=[new THREE.MeshPhongMaterial({map:(new THREE.TextureLoader).load("img/texture/texture_server.jpg")}),e,e,e,e,e],i=new THREE.Mesh(new THREE.BoxGeometry(Area10.cabinetLength,Area10.cabinetHeight,Area10.cabinetWidth),t);i.castShadow=!0,i.receiveShadow=!0,i.position.set(Wall.thickness+Area10.cabinetGapHorizontal+Area10.cabinetWidth/2,Area10.cabinetHeight/2,Wall.lengthLong-Wall.thickness-Area10.cabinetGapVertical-Area10.cabinetLength/2),scene.add(i);var a=i.clone();a.position.z-=Area10.cabinetLength+Area10.cabinetMargin,scene.add(a);var n=i.position.clone();n.z=(i.position.z+a.position.z)/2,routine[8]={targetPos:n,direction:"a"}}function initArea11(){var e=new THREE.TextureLoader,t=e.load("img/texture/texture_cabinet_secondary.jpg"),i=new THREE.MeshPhongMaterial({color:12500411}),a=Wall.lengthLong-Wall.thickness-Area11.cabinetGapVertical-Area11.cabinetLength/2,n=new THREE.Mesh(new THREE.BoxGeometry(Area11.cabinetWidth,Area11.cabinetHeight,Area11.cabinetLength),[i,new THREE.MeshPhongMaterial({map:t}),i,i,i,i]);n.castShadow=!0,n.receiveShadow=!0,n.position.set(-Area11.cabinetGapHorizontal-Area11.cabinetWidth/2,Area11.cabinetHeight/2,a),scene.add(n);var o=e.load("img/texture/texture_conditioner_stand.jpg"),r=new THREE.MeshPhongMaterial({color:15198442}),h=a-Area11.cabinetLength/2-Area11.conditionerMargin-Area11.conditionerLength/2,s=new THREE.Mesh(new THREE.BoxGeometry(Area11.conditionerWidth,Area11.conditionerHeight,Area11.conditionerLength),[r,new THREE.MeshPhongMaterial({map:o}),r,r,r,r]);s.castShadow=!0,s.receiveShadow=!0,s.position.set(-Area11.conditionerGap-Area11.conditionerWidth/2,Area11.conditionerHeight/2,h),scene.add(s);var l=e.load("img/texture/texture_fridge_light.jpg"),c=new THREE.MeshPhongMaterial({color:14475491}),d=h-Area11.conditionerLength/2-Area11.fridgeMargin-Area11.fridgeLength/2,g=new THREE.Mesh(new THREE.BoxGeometry(Area11.fridgeWidth,Area11.fridgeHeight,Area11.fridgeLength),[c,new THREE.MeshPhongMaterial({map:l}),c,c,c,c]);g.castShadow=!0,g.receiveShadow=!0,g.position.set(-Area11.fridgeGap-Area11.fridgeWidth/2,Area11.fridgeHeight/2,d),scene.add(g);var w=e.load("img/texture/texture_heater_stand.jpg"),p=new THREE.MeshPhongMaterial({color:10724772}),E=d-Area11.fridgeLength/2-Area11.heaterMargin-Area11.heaterRadius,k=new THREE.Mesh(new THREE.CylinderGeometry(Area11.heaterRadius,Area11.heaterRadius,Area11.heaterHeight,32),[new THREE.MeshPhongMaterial({map:w}),p,p]);k.rotation.y=Math.PI/2,k.castShadow=!0,k.receiveShadow=!0,k.position.set(-Area11.heaterGap-Area11.heaterRadius/2,Area11.heaterHeight/2,E),scene.add(k);var T=new Desk({length:Area11.deskLength,height:Area11.deskHeight,width:Area11.deskWidth});T.position.set(-Area11.deskGapHorizontal-Area11.deskLength/2,Area11.deskHeight/2,Wall.lengthLong-Wall.thickness-Area11.deskGapVertical-Area11.deskWidth/2),scene.add(T);var W=new Desk({length:Area11.deskLength,height:Area11.deskHeight,width:Area11.deskWidth});W.position.set(-Wall.lengthLong/2,Area11.deskHeight/2,Wall.thickness+Area11.deskGapVertical+Area11.deskWidth/2),scene.add(W);var u=new Computer({length:PC.length,width:PC.width,height:PC.height});u.position.set(-Wall.lengthLong/2,Area11.deskHeight+PC.height/2,Wall.thickness+Area11.deskGapVertical+Area11.deskWidth/2),scene.add(u);var m=k.position.clone();m.z=Wall.lengthLong/2,routine[11]={targetPos:m,direction:"d"}}function initArea12(){var e=new THREE.TextureLoader,t=new THREE.Group,i=(Area12.fridgeGapHorizontal+Area12.fridgeWidth)/2,a=Area12.heaterAltitude+2*Area12.heaterRadius,n=Area12.conditionerAltitude+Area12.conditionerHeight,o=(n<a?a:n)/2,r=(Area12.conditionerLength+Area12.heaterMargin+Area12.heaterLength)/2,h=e.load("img/texture/texture_fridge_dark.jpg"),s=new THREE.MeshPhongMaterial({color:4869721}),l=new THREE.Mesh(new THREE.BoxGeometry(Area12.fridgeWidth,Area12.fridgeHeight,Area12.fridgeLength),[new THREE.MeshPhongMaterial({map:h}),s,s,s,s,s]);l.castShadow=!0,l.receiveShadow=!0,l.position.x+=Area12.fridgeGapHorizontal+Area12.fridgeWidth/2-i,l.position.y+=Area12.fridgeHeight/2-o,l.position.z+=Area12.conditionerLength/2-r,t.add(l);var c=e.load("img/texture/texture_conditioner_hang.jpg"),d=new THREE.MeshPhongMaterial({color:15921647}),g=new THREE.Mesh(new THREE.BoxGeometry(Area12.conditionerWidth,Area12.conditionerHeight,Area12.conditionerLength),[new THREE.MeshPhongMaterial({map:c}),d,d,d,d,d]);g.castShadow=!0,g.receiveShadow=!0,g.position.x+=Area12.conditionerWidth/2-i,g.position.y+=Area12.conditionerAltitude+Area12.conditionerHeight/2-o,g.position.z+=Area12.conditionerLength/2-r,t.add(g);var w=e.load("img/texture/texture_heater_hang.jpg");w.rotation=Math.PI/-2,w.center=new THREE.Vector2(.5,.5);var p=new THREE.MeshPhongMaterial({color:1193046}),E=new THREE.Mesh(new THREE.CylinderGeometry(Area12.heaterRadius,Area12.heaterRadius,Area12.heaterLength,32),[new THREE.MeshPhongMaterial({map:w}),p,p]);E.castShadow=!0,E.receiveShadow=!0,E.rotation.x=Math.PI/2,E.rotation.y=Math.PI/-2,E.position.x+=Area12.heaterRadius-i,E.position.y+=Area12.heaterAltitude+Area12.heaterRadius-o,E.position.z+=Area12.conditionerLength+Area12.heaterMargin+Area12.heaterLength/2-r,t.add(E),t.position.set(i-Wall.lengthLong,o,Wall.thickness+Area12.fridgeGapVertical+r),scene.add(t);var k=t.clone();k.position.z+=2*r+Area12.heaterMargin,scene.add(k);var T=new Desk({length:Area12.deskLength,height:Area12.deskHeight,width:Area12.deskWidth});T.position.set(Area12.deskGapHorizontal+Area12.deskLength/2-Wall.lengthLong,Area12.deskHeight/2,Wall.lengthLong-Wall.thickness-Area12.deskGapVertical-Area12.deskWidth/2),T.rotation.y=Math.PI/2,scene.add(T);var W=new THREE.Mesh(new THREE.BoxGeometry(Device.length,Device.height,Device.width),new THREE.MeshPhongMaterial({color:Colors.Device}));W.castShadow=!0,W.receiveShadow=!0,W.rotation.y=Math.PI/2,W.position.set(Area12.deskGapHorizontal+Area12.deskLength/2-Wall.lengthLong,Area12.deskHeight+Device.height/2,Wall.lengthLong-Wall.thickness-Area12.deskGapVertical-Area12.deskWidth/2),scene.add(W);var u=new Hint({text:"非侵入式终端",wordInOneLine:3});u.bindTo(W),scene.add(u);var m=t.position.clone();m.z=Wall.lengthLong/2,routine[10]={targetPos:m,direction:"a"}}function initRoutine(){var e=new THREE.LineDashedMaterial({color:3905041,linewidth:5}),t=new THREE.Geometry,i=.05;t.vertices.push(new THREE.Vector3(2*Wall.lengthLong+2*Wall.thickness-Door.gapEntry-Door.widthEntry/2,i,Wall.lengthLong+3*Corridor.width),new THREE.Vector3(2*Wall.lengthLong+2*Wall.thickness-Door.gapEntry-Door.widthEntry/2,i,Wall.lengthLong/2),new THREE.Vector3(Wall.thickness+Wall.height,i,Wall.lengthLong/2),new THREE.Vector3(Wall.thickness+Wall.height,i,Wall.thickness+Door.gapExit+Door.widthExit/2),new THREE.Vector3(-Wall.height,i,Wall.thickness+Door.gapExit+Door.widthExit/2),new THREE.Vector3(-Wall.height,i,Wall.lengthLong/2),new THREE.Vector3(Wall.height-Wall.lengthLong,i,Wall.lengthLong/2),new THREE.Vector3(Wall.height-Wall.lengthLong,i,Wall.lengthLong-4*Wall.thickness),new THREE.Vector3(Door.gapSecondary+Door.widthSecondary/2-Wall.lengthLong,i,Wall.lengthLong-4*Wall.thickness),new THREE.Vector3(Door.gapSecondary+Door.widthSecondary/2-Wall.lengthLong,i,Wall.lengthLong+3*Corridor.width));var a=new THREE.Line(t,e);a.computeLineDistances(),a.name="route-line",a.visible=!1,scene.add(a)}function initControls(){(controls=new THREE.OrbitControls(camera,renderer.domElement)).target.copy(cameraInitTarget),controls.minDistance=50,controls.maxDistance=500,controls.maxPolarAngle=Math.PI/2,controls.panSpeed=.5,controls.rotateSpeed=.25,controls.zoomSpeed=.5,controls.saveState(),controls.update()}function addAnimation(e){if(!((e={meshObject:e.meshObject,duration:e.duration||1,name:e.name,timeArray:e.timeArray,frames:e.frames,loop:e.loop||THREE.LoopOnce,loopCount:e.loopCount||0,loopCallback:e.loopCallback,finishCallback:e.finishCallback}).meshObject&&e.name&&e.timeArray&&e.frames))throw new Error("参数缺失");var t=[],i=!0,a=!1,n=void 0;try{for(var o,r=e.frames[Symbol.iterator]();!(i=(o=r.next()).done);i=!0){var h=o.value,s=h.property,l=h.values;t.push(new THREE.KeyframeTrack(s,e.timeArray,l))}}catch(e){a=!0,n=e}finally{try{i||null==r.return||r.return()}finally{if(a)throw n}}var c=new THREE.AnimationClip(e.name,e.duration,t),d=new THREE.AnimationMixer(e.meshObject),g=d.clipAction(c);e.loopCallback&&d.addEventListener("loop",e.loopCallback),e.finishCallback&&d.addEventListener("finished",e.finishCallback),g.setLoop(e.loop,e.loopCount),animateActions[e.name]=g}function switchAnimating(e){animatingAction&&animatingAction.isRunning()||((animatingAction=animateActions[e]).paused?animatingAction.paused=!1:animatingAction.reset().play())}function render(){renderer.render(scene,camera)}function animate(){requestAnimationFrame(animate),render(),controls.update(),TWEEN.update(),animatingAction&&animatingAction.getMixer().update(clock.getDelta())}function onWindowResize(){var e=window.innerWidth,t=window.innerHeight;renderer.setSize(e,t),camera.aspect=e/t,camera.updateProjectionMatrix()}function switchStatus(e){var t=e.getAttribute("data-status"),i=e.getElementsByTagName("use")[0],a=i.getAttribute("xlink:href"),n=a.match(/\w+$/)[0];e.setAttribute("data-status",n),i.setAttribute("xlink:href",a.replace(/\w+$/,t))}function toolWalk(e){var t=document.querySelector("button[data-status=off]");t&&t.click();var i=e.getAttribute("data-status");switchStatus(e),e.title="walk"===i?"暂停巡航":"开启巡航",scene.getObjectByName("route-line").visible="walk"===i,iteratorRoutine=-1===iteratorRoutine?setInterval(runRoutine,Camera.gazeTime):(clearInterval(iteratorRoutine),-1)}function toolEye(e){var t=e.getAttribute("data-status");switchStatus(e),e.title="on"===t?"隐藏运行状态":"显示运行状态",signs.map(function(e){e.visible="on"===t})}function toolReset(){camera.position.copy(cameraInitPosition),controls.reset()}function lookAt(e){var t,i,a=e.targetPos,n=e.direction;switch(new TWEEN.Tween(controls.target).to({x:a.x,y:a.y,z:a.z},600).easing(TWEEN.Easing.Cubic.InOut).start(),n){case"w":t=a.x,i=a.z+Camera.distance;break;case"s":t=a.x,i=a.z-Camera.distance;break;case"a":t=a.x+Camera.distance,i=a.z;break;case"d":t=a.x-Camera.distance,i=a.z}new TWEEN.Tween(camera.position).to({x:t,y:Camera.altitude,z:i},600).easing(TWEEN.Easing.Cubic.InOut).start()}function runRoutine(){if(-1!==iterator){var e=routine[iterator].signs;e&&e.map(function(e){return e.visible=!1})}iterator=(iterator+1)%routine.length;var t=routine[iterator];lookAt(t);var i=t.signs;i&&i.map(function(e){return e.visible=!0})}function queryData(){scene.getObjectByName("sign-area2-adr").update(randomData()),scene.getObjectByName("sign-area3-heat-barrel").update(randomData()),scene.getObjectByName("sign-area3-ice-barrel").update(randomData()),scene.getObjectByName("sign-area4-rlc").update(randomData()),setTimeout(queryData,Data.refreshInterval)}function randomData(){var e=randomIn("on","pause","off");return{status:translateType(e),data:(15*Math.random()).toFixed(1)+"kW",boardType:e}}function translateType(e){switch(e){case"off":return"离线";case"pause":return"停机";case"on":default:return"运行"}}function randomIn(){var e=Math.random()*arguments.length;return(0|e)<0||arguments.length<=(0|e)?void 0:arguments[0|e]}draw();